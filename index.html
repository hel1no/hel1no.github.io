<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé∞ VIP CASINO | Jetzt Spielen</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== RESET & VARIABLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    :root {
      --primary: #0f0f23;
      --secondary: #1a1a2e;
      --accent: #00ff88;
      --danger: #ff3860;
      --white: #ffffff;
      --gold: #FFD700;
    }

    body {
      background: var(--primary);
      color: var(--white);
      min-height: 100vh;
    }

    /* ===== MODALS ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--secondary);
      padding: 40px;
      border-radius: 20px;
      width: 90%;
      max-width: 400px;
      border: 2px solid var(--accent);
      box-shadow: 0 0 50px rgba(0, 255, 136, 0.3);
    }

    .modal h2 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--accent);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #ccc;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      font-size: 16px;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .form-buttons {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      flex: 1;
    }

    .btn-primary {
      background: var(--accent);
      color: black;
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid var(--accent);
      color: var(--accent);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 255, 136, 0.3);
    }

    .error-message {
      color: var(--danger);
      text-align: center;
      margin-top: 10px;
      min-height: 20px;
    }

    /* ===== HEADER ===== */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: 20px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(15, 15, 35, 0.95);
      border-bottom: 2px solid rgba(0, 255, 136, 0.2);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
    }

    .logo-icon {
      font-size: 2.5rem;
      color: var(--gold);
    }

    .logo-text {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(45deg, #00ff88, #00ccff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ===== USER INFO ===== */
    .user-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .balance-card {
      padding: 12px 20px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(0, 255, 136, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .balance-amount {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--accent);
    }

    /* ===== MAIN CONTENT ===== */
    .main-container {
      margin-top: 120px;
      padding: 20px 5%;
      max-width: 1400px;
      margin-left: auto;
      margin-right: auto;
    }

    /* ===== HERO SECTION ===== */
    .hero {
      text-align: center;
      padding: 60px 20px;
      margin-bottom: 40px;
    }

    .hero-title {
      font-size: 3.5rem;
      margin-bottom: 20px;
      background: linear-gradient(45deg, #00ff88, #00ccff, #ff00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero-subtitle {
      font-size: 1.2rem;
      color: #aaa;
      max-width: 700px;
      margin: 0 auto 40px;
      line-height: 1.6;
    }

    /* ===== GAMES GRID ===== */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 25px;
      margin-bottom: 60px;
    }

    .game-card {
      background: linear-gradient(145deg, #1a1a2e, #16213e);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .game-card:hover {
      transform: translateY(-10px);
      border-color: var(--accent);
      box-shadow: 0 20px 40px rgba(0, 255, 136, 0.2);
    }

    .game-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .game-title {
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: white;
    }

    .game-desc {
      color: #bbb;
      margin-bottom: 25px;
      line-height: 1.5;
    }

    .play-btn {
      background: var(--accent);
      color: black;
      border: none;
      padding: 12px 30px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 0 auto;
      transition: all 0.3s;
    }

    .play-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 20px rgba(0, 255, 136, 0.3);
    }

    /* ===== GAME AREAS ===== */
    .game-area {
      display: none;
      background: var(--secondary);
      border-radius: 25px;
      padding: 30px;
      margin-top: 30px;
      border: 3px solid var(--accent);
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(0, 255, 136, 0.3);
    }

    .game-title-area {
      font-size: 2rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .back-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
    }

    /* ===== SLOT MACHINE ===== */
    .slot-machine {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 40px 0;
    }

    .slot-reel {
      width: 120px;
      height: 120px;
      background: linear-gradient(145deg, #2c3e50, #34495e);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
      border: 4px solid var(--accent);
      overflow: hidden;
    }

    .slot-reel.spinning {
      animation: spin 0.5s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotateX(0); }
      100% { transform: rotateX(360deg); }
    }

    /* ===== CONTROLS ===== */
    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
      margin-top: 40px;
    }

    .bet-controls {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .bet-input {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 12px;
      color: white;
      font-size: 1.1rem;
      width: 150px;
      text-align: center;
      font-weight: bold;
    }

    .chip-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .chip {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      border: 3px solid white;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .chip:hover {
      transform: scale(1.1);
    }

    /* ===== RESULTS ===== */
    .result {
      margin-top: 30px;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
      display: none;
    }

    .result.win {
      background: rgba(0, 255, 136, 0.1);
      border: 2px solid var(--accent);
      color: var(--accent);
      display: block;
    }

    .result.loss {
      background: rgba(255, 56, 96, 0.1);
      border: 2px solid var(--danger);
      color: var(--danger);
      display: block;
    }

    /* ===== FOOTER ===== */
    .footer {
      text-align: center;
      padding: 40px 20px;
      margin-top: 80px;
      color: #888;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
      }

      .hero-title {
        font-size: 2.5rem;
      }

      .games-grid {
        grid-template-columns: 1fr;
      }

      .slot-machine {
        flex-direction: column;
        align-items: center;
      }

      .game-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
<header class="header">
  <div class="logo" onclick="goHome()">
    <i class="fas fa-crown logo-icon"></i>
    <h1 class="logo-text">VIP CASINO</h1>
  </div>

  <div id="guestView" class="user-info">
    <button class="btn btn-primary" onclick="showLogin()">
      <i class="fas fa-sign-in-alt"></i> Login
    </button>
    <button class="btn btn-secondary" onclick="showRegister()">
      <i class="fas fa-user-plus"></i> Register
    </button>
  </div>

  <div id="userView" class="user-info" style="display: none;">
    <div class="user-avatar" id="userAvatar">U</div>
    <div class="balance-card">
      <i class="fas fa-coins" style="color: #00ff88;"></i>
      <span class="balance-amount" id="balanceAmount">0</span>
    </div>
    <button class="btn btn-secondary" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
  </div>
</header>

<div id="loginModal" class="modal">
  <div class="modal-content">
    <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
    <div class="form-group">
      <label for="loginUsername">Benutzername:</label>
      <input type="text" id="loginUsername" placeholder="Dein Benutzername">
    </div>
    <div class="form-group">
      <label for="loginPassword">Passwort:</label>
      <input type="password" id="loginPassword" placeholder="Dein Passwort">
    </div>
    <div id="loginError" class="error-message"></div>
    <div class="form-buttons">
      <button class="btn btn-primary" onclick="performLogin()">Login</button>
      <button class="btn btn-secondary" onclick="hideModal('loginModal')">Abbrechen</button>
    </div>
  </div>
</div>

<div id="registerModal" class="modal">
  <div class="modal-content">
    <h2><i class="fas fa-user-plus"></i> Registrieren</h2>
    <div class="form-group">
      <label for="regUsername">Benutzername:</label>
      <input type="text" id="regUsername" placeholder="W√§hle einen Benutzernamen">
    </div>
    <div class="form-group">
      <label for="regEmail">Email:</label>
      <input type="email" id="regEmail" placeholder="Deine Email-Adresse">
    </div>
    <div class="form-group">
      <label for="regPassword">Passwort:</label>
      <input type="password" id="regPassword" placeholder="Mindestens 6 Zeichen">
    </div>
    <div id="registerError" class="error-message"></div>
    <div class="form-buttons">
      <button class="btn btn-primary" onclick="performRegister()">Registrieren</button>
      <button class="btn btn-secondary" onclick="hideModal('registerModal')">Abbrechen</button>
    </div>
  </div>
</div>

<div class="main-container">
  <div class="hero">
    <h1 class="hero-title">üé∞ WILLKOMMEN IM VIP CASINO üé≤</h1>
    <p class="hero-subtitle">
      Spiele die besten Casino-Spiele mit Echtzeit-Guthaben. Registriere dich jetzt und erhalte 10.000 Gratis-Credits!
    </p>
    <div id="heroButtons">
      <button class="btn btn-primary" style="padding: 15px 40px; font-size: 1.2rem;" onclick="showRegister()">
        <i class="fas fa-gem"></i> KOSTENLOS SPIELEN
      </button>
    </div>
  </div>

  <div class="games-grid" id="gamesGrid">
  </div>

  <div class="game-area" id="slotGame">
    <div class="game-header">
      <h2 class="game-title-area">
        <i class="fas fa-sliders-h"></i> SLOT MACHINE
      </h2>
      <button class="back-btn" onclick="hideGame()">
        <i class="fas fa-times"></i> SCHLIESSEN
      </button>
    </div>

    <div class="slot-container">
      <div class="slot-machine">
        <div class="slot-reel" id="slotReel1">üçí</div>
        <div class="slot-reel" id="slotReel2">üçí</div>
        <div class="slot-reel" id="slotReel3">üçí</div>
      </div>

      <div class="controls">
        <div class="bet-controls">
          <input type="number" class="bet-input" id="slotBet" value="100" min="10" max="10000">
          <button class="btn btn-primary" onclick="spinSlot()">
            <i class="fas fa-play"></i> SPINNEN
          </button>
        </div>
        <div class="chip-container">
          <div class="chip" style="background: #3498db;" onclick="setBet(10)">10</div>
          <div class="chip" style="background: #e74c3c;" onclick="setBet(50)">50</div>
          <div class="chip" style="background: #2ecc71;" onclick="setBet(100)">100</div>
          <div class="chip" style="background: #9b59b6;" onclick="setBet(500)">500</div>
          <div class="chip" style="background: #f1c40f;" onclick="setBet(1000)">1000</div>
        </div>
      </div>
    </div>

    <div class="result" id="slotResult"></div>
  </div>
</div>

<footer class="footer">
  <p>¬© 2024 VIP CASINO - Nur zu Unterhaltungszwecken. Kein echtes Geld.</p>
  <p style="margin-top: 10px; font-size: 0.9em;">F√ºr Spieler ab 18 Jahren. Spielen Sie verantwortungsbewusst.</p>
</footer>

<script>
  // ===== KONFIGURATION =====
  // WICHTIG: Wenn die App auf Render l√§uft, ist die API auf der gleichen URL.
  // Lokal nutzen wir localhost:3000
  const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:3000'
    : '';

  // ===== GLOBALE VARIABLEN =====
  let currentUser = null;
  let balance = 0;
  let currentGame = null;
  let token = localStorage.getItem('casino_token');

  // ===== INITIALISIERUNG =====
  document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    initGames();

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        hideAllModals();
        if (currentGame) hideGame();
      }
    });
  });

  // ===== AUTHENTIFIZIERUNG =====
  function checkAuth() {
    if (token) {
      loadUserData();
    } else {
      showGuestView();
    }
  }

  function showLogin() {
    showModal('loginModal');
    document.getElementById('loginError').textContent = '';
  }

  function showRegister() {
    showModal('registerModal');
    document.getElementById('registerError').textContent = '';
  }

  async function performLogin() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    if (!username || !password) {
      document.getElementById('loginError').textContent = 'Bitte f√ºlle alle Felder aus';
      return;
    }

    try {
      const response = await fetch(`${API_URL}/api/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (data.success) {
        token = data.token;
        localStorage.setItem('casino_token', token);
        currentUser = data.user;
        balance = data.user.balance;

        hideModal('loginModal');
        showUserView();
        updateUI();
      } else {
        document.getElementById('loginError').textContent = data.error || 'Login fehlgeschlagen';
      }
    } catch (error) {
      document.getElementById('loginError').textContent = 'Verbindungsfehler';
    }
  }

  async function performRegister() {
    const username = document.getElementById('regUsername').value;
    const email = document.getElementById('regEmail').value;
    const password = document.getElementById('regPassword').value;

    if (!username || !email || !password) {
      document.getElementById('registerError').textContent = 'Bitte f√ºlle alle Felder aus';
      return;
    }

    try {
      const response = await fetch(`${API_URL}/api/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, email, password })
      });

      const data = await response.json();

      if (data.success) {
        token = data.token;
        localStorage.setItem('casino_token', token);
        currentUser = data.user;
        balance = data.user.balance;

        hideModal('registerModal');
        showUserView();
        updateUI();
      } else {
        document.getElementById('registerError').textContent = data.error || 'Registrierung fehlgeschlagen';
      }
    } catch (error) {
      document.getElementById('registerError').textContent = 'Verbindungsfehler';
    }
  }

  async function loadUserData() {
    try {
      const response = await fetch(`${API_URL}/api/user`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await response.json();
      if (data.success) {
        currentUser = data.user;
        balance = data.user.balance;
        showUserView();
        updateUI();
      } else {
        logout();
      }
    } catch (error) {
      console.error('Fehler:', error);
    }
  }

  async function updateBalance(amount, gameType = 'slot', win = false) {
    balance += amount;
    if (balance < 0) balance = 0;

    if (token) {
      try {
        const response = await fetch(`${API_URL}/api/balance/update`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ amount, gameType, win })
        });
        const data = await response.json();
        if (data.success) balance = data.newBalance;
      } catch (error) {
        console.error('Update Fehler:', error);
      }
    }
    updateUI();
    return balance;
  }

  function logout() {
    token = null;
    currentUser = null;
    localStorage.removeItem('casino_token');
    showGuestView();
    hideGame();
  }

  function showGuestView() {
    document.getElementById('guestView').style.display = 'flex';
    document.getElementById('userView').style.display = 'none';
  }

  function showUserView() {
    document.getElementById('guestView').style.display = 'none';
    document.getElementById('userView').style.display = 'flex';
  }

  function updateUI() {
    document.getElementById('balanceAmount').textContent = balance.toLocaleString();
    if (currentUser) {
      document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
    }
  }

  function showModal(modalId) { document.getElementById(modalId).style.display = 'flex'; }
  function hideModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
  function hideAllModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

  function initGames() {
    const games = [
      { id: 'slot', name: 'SLOT MACHINE', icon: 'fas fa-sliders-h', desc: 'Klassische Spielautomaten mit 3 Walzen.' }
    ];
    const gamesGrid = document.getElementById('gamesGrid');
    gamesGrid.innerHTML = '';
    games.forEach(game => {
      const card = document.createElement('div');
      card.className = 'game-card';
      card.onclick = () => showGame(game.id);
      card.innerHTML = `<div class="game-icon"><i class="${game.icon}"></i></div><h3 class="game-title">${game.name}</h3><p class="game-desc">${game.desc}</p><button class="play-btn">SPIELEN</button>`;
      gamesGrid.appendChild(card);
    });
  }

  function showGame(gameId) {
    if (!token) { alert('Bitte einloggen!'); return; }
    document.getElementById('gamesGrid').style.display = 'none';
    document.getElementById(gameId + 'Game').style.display = 'block';
    currentGame = gameId;
  }

  function hideGame() {
    document.querySelectorAll('.game-area').forEach(a => a.style.display = 'none');
    document.getElementById('gamesGrid').style.display = 'grid';
    currentGame = null;
  }

  function setBet(amount) { document.getElementById('slotBet').value = amount; }

  async function spinSlot() {
    const bet = parseInt(document.getElementById('slotBet').value);
    if (bet > balance) { alert('Nicht genug Guthaben!'); return; }

    const reels = document.querySelectorAll('.slot-reel');
    reels.forEach(r => r.classList.add('spinning'));

    await updateBalance(-bet, 'slot', false);

    setTimeout(async () => {
      reels.forEach(r => r.classList.remove('spinning'));
      const symbols = ['üçí', 'üíé', '7Ô∏è‚É£', 'üí∞'];
      const results = [symbols[Math.floor(Math.random()*4)], symbols[Math.floor(Math.random()*4)], symbols[Math.floor(Math.random()*4)]];

      document.getElementById('slotReel1').textContent = results[0];
      document.getElementById('slotReel2').textContent = results[1];
      document.getElementById('slotReel3').textContent = results[2];

      let mult = (results[0] === results[1] && results[1] === results[2]) ? 10 : 0;
      const resEl = document.getElementById('slotResult');

      if (mult > 0) {
        await updateBalance(bet * mult, 'slot', true);
        resEl.textContent = `GEWONNEN: ${bet * mult}`;
        resEl.className = 'result win';
      } else {
        resEl.textContent = `VERLOREN: ${bet}`;
        resEl.className = 'result loss';
      }
    }, 1000);
  }

  function goHome() { hideGame(); }
</script>
</body>
</html>
